<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agendamento - Barbearia</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: white;
}

.container {
  max-width: 500px;
  margin: auto;
  padding: 20px;
}

h1 {
  text-align: center;
  color: #d4af37;
}

.card {
  background: #1a1a1a;
  border: 1px solid #d4af37;
  border-radius: 15px;
  padding: 15px;
  margin-bottom: 15px;
  cursor: pointer;
  text-align: center;
  transition: 0.3s;
}

.card:hover {
  background: #d4af37;
  color: black;
}

.selected {
  background: #d4af37;
  color: black;
}

button {
  width: 100%;
  padding: 15px;
  background: #d4af37;
  border: none;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 15px;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  border-radius: 8px;
  border: none;
}
</style>
</head>

<body>
<div class="container">

<h1>Agendamento</h1>

<h3>Selecione o Servi√ßo</h3>
<div id="servicos"></div>

<h3>Selecione o Dia</h3>
<div id="dias"></div>

<h3>Selecione o Hor√°rio</h3>
<div id="horarios"></div>

<h3>Seus Dados</h3>
<input type="text" id="nome" placeholder="Nome e Sobrenome" required>
<input type="tel" id="telefone" placeholder="Telefone" required>

<button onclick="agendar()">Confirmar Agendamento</button>

</div>

<script>

const supabase = supabase.createClient(
  "https://vmtizubcbzcscvrjnbkc.supabase.co",
  "SUA_ANON_KEY_AQUI"
);

let servicoSelecionado = "";
let diaSelecionado = "";
let horarioSelecionado = "";

// üî• SERVI√áOS NA ORDEM PEDIDA
const servicosLista = [
  { nome: "Corte", valor: "R$ 30" },
  { nome: "Barba", valor: "R$ 20" },
  { nome: "Sobrancelha", valor: "R$ 15" },
  { nome: "Pezinho", valor: "R$ 15" },
  { nome: "Corte + Sobrancelha", valor: "R$ 35" },
  { nome: "Corte + Barba", valor: "R$ 40" },
  { nome: "Corte + Barba + Sobrancelha", valor: "R$ 45" },
  { nome: "Sidcut", valor: "R$ 20" }
];

function carregarServicos() {
  const container = document.getElementById("servicos");
  container.innerHTML = "";
  servicosLista.forEach(servico => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<strong>${servico.nome}</strong><br>${servico.valor}`;
    div.onclick = () => {
      servicoSelecionado = servico.nome;
      document.querySelectorAll("#servicos .card").forEach(c => c.classList.remove("selected"));
      div.classList.add("selected");
    };
    container.appendChild(div);
  });
}

function gerarDias() {
  const container = document.getElementById("dias");
  container.innerHTML = "";

  for (let i = 0; i < 7; i++) {
    let data = new Date();
    data.setDate(data.getDate() + i);

    if (data.getDay() === 0) continue; // üî• BLOQUEIA DOMINGO

    let dia = data.toLocaleDateString("pt-BR");
    let nomeDia = data.toLocaleDateString("pt-BR", { weekday: "long" });

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<strong>${dia}</strong><br>${nomeDia}`;
    div.onclick = () => {
      diaSelecionado = dia;
      document.querySelectorAll("#dias .card").forEach(c => c.classList.remove("selected"));
      div.classList.add("selected");
      gerarHorarios();
    };
    container.appendChild(div);
  }
}

async function gerarHorarios() {
  const container = document.getElementById("horarios");
  container.innerHTML = "";

  let horarios = [];

  for (let h = 8; h <= 18; h++) {
    horarios.push(`${h}:00`);
    horarios.push(`${h}:30`);
  }

  const { data } = await supabase
    .from("agendamentos")
    .select("horario")
    .eq("dia", diaSelecionado);

  const ocupados = data ? data.map(item => item.horario) : [];

  horarios.forEach(horario => {
    if (ocupados.includes(horario)) return; // üî• N√ÉO MOSTRA HOR√ÅRIO J√Å AGENDADO

    const div = document.createElement("div");
    div.className = "card";
    div.innerText = horario;
    div.onclick = () => {
      horarioSelecionado = horario;
      document.querySelectorAll("#horarios .card").forEach(c => c.classList.remove("selected"));
      div.classList.add("selected");
    };
    container.appendChild(div);
  });
}

async function agendar() {
  const nome = document.getElementById("nome").value;
  const telefone = document.getElementById("telefone").value;

  if (!nome.includes(" ")) {
    alert("Digite nome e sobrenome.");
    return;
  }

  if (!servicoSelecionado || !diaSelecionado || !horarioSelecionado) {
    alert("Preencha tudo.");
    return;
  }

  await supabase.from("agendamentos").insert([
    {
      nome,
      telefone,
      servico: servicoSelecionado,
      dia: diaSelecionado,
      horario: horarioSelecionado
    }
  ]);

  alert("Agendamento realizado com sucesso!");
  location.reload();
}

carregarServicos();
gerarDias();

</script>
</body>
</html>
