<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Menezes Barbearia</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
background:#0d0d0d;
font-family:Arial, sans-serif;
color:white;
margin:0;
text-align:center;
}

h1{
color:#d4af37;
margin-top:20px;
}

.container{
max-width:400px;
margin:auto;
padding:20px;
}

.card{
border:1px solid #d4af37;
border-radius:15px;
padding:15px;
margin-bottom:12px;
cursor:pointer;
transition:0.3s;
}

.card:hover{
background:#d4af37;
color:black;
}

.selected{
background:#d4af37;
color:black;
}

button{
background:#d4af37;
color:black;
border:none;
padding:15px;
width:100%;
border-radius:10px;
font-weight:bold;
margin-top:15px;
cursor:pointer;
}

input{
width:100%;
padding:12px;
margin:10px 0;
border-radius:8px;
border:none;
}

.grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
}

.small{
font-size:12px;
opacity:0.8;
}
</style>
</head>

<body>

<h1>Menezes Barbearia</h1>

<div class="container">

<h3>Escolha o Servi√ßo</h3>
<div id="servicos"></div>

<h3>Selecione o Dia</h3>
<div id="dias"></div>

<h3>Hor√°rios Dispon√≠veis</h3>
<div id="horarios" class="grid"></div>

<h3>Seus Dados</h3>
<input type="text" id="nome" placeholder="Nome e Sobrenome">
<input type="text" id="telefone" placeholder="Telefone">

<button onclick="agendar()">CONFIRMAR AGENDAMENTO</button>

</div>

<script>
const supabaseClient = supabase.createClient(
"https://vmtizubcbzcscvrjnbkc.supabase.co",
"sb_publishable_yTBSdMmjv1qIH8V9FViobw_DBIwtm_D"
);

const servicos = [
{nome:"Corte",valor:"R$ 30"},
{nome:"Barba",valor:"R$ 20"},
{nome:"Sobrancelha",valor:"R$ 15"},
{nome:"Pezinho",valor:"R$ 15"},
{nome:"Corte + Sobrancelha",valor:"R$ 35"},
{nome:"Corte + Barba",valor:"R$ 40"},
{nome:"Corte + Barba + Sobrancelha",valor:"R$ 45"},
{nome:"Sidcut",valor:"R$ 20"}
];

let servicoSelecionado=null;
let diaSelecionado=null;
let horarioSelecionado=null;

function renderServicos(){
let div=document.getElementById("servicos");
servicos.forEach(s=>{
let el=document.createElement("div");
el.className="card";
el.innerHTML=`<b>${s.nome}</b><br><span class="small">${s.valor}</span>`;
el.onclick=()=>{
document.querySelectorAll("#servicos .card").forEach(c=>c.classList.remove("selected"));
el.classList.add("selected");
servicoSelecionado=s.nome;
};
div.appendChild(el);
});
}

// üî• SEGUNDA A S√ÅBADO FIXO NA ORDEM
function gerarDias(){
let div = document.getElementById("dias");
div.innerHTML = "";

let hoje = new Date();
let diaAtual = hoje.getDay();
let diasAteSegunda = (diaAtual === 0 ? 1 : 8 - diaAtual);
let primeiraSegunda = new Date();
primeiraSegunda.setDate(hoje.getDate() + diasAteSegunda - 7);

const diasSemana = ["Seg", "Ter", "Qua", "Qui", "Sex", "S√°b"];

for(let i = 0; i < 6; i++){
let data = new Date(primeiraSegunda);
data.setDate(primeiraSegunda.getDate() + i);

let dia = String(data.getDate()).padStart(2,'0');
let mes = String(data.getMonth()+1).padStart(2,'0');
let format = `${dia}/${mes}`;

let el = document.createElement("div");
el.className = "card";
el.innerHTML = `${format}<br><span class="small">${diasSemana[i]}</span>`;

el.onclick = () => {
document.querySelectorAll("#dias .card").forEach(c=>c.classList.remove("selected"));
el.classList.add("selected");
diaSelecionado = format;
gerarHorarios();
};

div.appendChild(el);
}
}

async function gerarHorarios(){
let div=document.getElementById("horarios");
div.innerHTML="";
horarioSelecionado=null;

let {data}=await supabaseClient
.from("agendamentos")
.select("horario")
.eq("dia",diaSelecionado);

let ocupados=data?data.map(d=>d.horario):[];

for(let h=8;h<=15;h++){
for(let m of ["00","30"]){
if(h==15 && m=="30") continue;
let horario=`${String(h).padStart(2,"0")}:${m}`;

if(!ocupados.includes(horario)){
let el=document.createElement("div");
el.className="card";
el.innerHTML=horario;
el.onclick=()=>{
document.querySelectorAll("#horarios .card").forEach(c=>c.classList.remove("selected"));
el.classList.add("selected");
horarioSelecionado=horario;
};
div.appendChild(el);
}
}
}
}

async function agendar(){
let nome=document.getElementById("nome").value.trim();
let telefone=document.getElementById("telefone").value.trim();

// üî• valida√ß√£o forte nome + sobrenome
if(!nome || nome.split(" ").filter(p=>p.length>1).length<2){
alert("Digite nome e sobrenome corretamente.");
return;
}

if(!servicoSelecionado||!diaSelecionado||!horarioSelecionado){
alert("Preencha todas as op√ß√µes.");
return;
}

await supabaseClient.from("agendamentos").insert([{
nome,
telefone,
servico:servicoSelecionado,
dia:diaSelecionado,
horario:horarioSelecionado
}]);

alert("Agendamento realizado com sucesso!");
location.reload();
}

renderServicos();
gerarDias();
</script>

</body>
</html>
