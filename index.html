<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Menezes Barbearia</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
body{
background:#0d0d0d;
font-family:Arial;
color:white;
margin:0;
padding:0;
text-align:center;
}

h1{
color:#d4af37;
margin-top:20px;
}

.container{
max-width:400px;
margin:auto;
padding:20px;
}

.card{
border:1px solid #d4af37;
border-radius:15px;
padding:15px;
margin-bottom:15px;
cursor:pointer;
transition:0.3s;
}

.card:hover{
background:#d4af37;
color:black;
}

.selected{
background:#d4af37;
color:black;
}

button{
background:#d4af37;
color:black;
border:none;
padding:15px;
width:100%;
border-radius:10px;
font-weight:bold;
margin-top:15px;
cursor:pointer;
}

input{
width:100%;
padding:10px;
margin:10px 0;
border-radius:8px;
border:none;
}

.grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:8px;
}

.small{
font-size:12px;
opacity:0.8;
}
</style>
</head>

<body>

<h1>Menezes Barbearia</h1>

<div class="container">

<h3>Escolha o Serviço</h3>
<div id="servicos"></div>

<h3>Selecione o Dia</h3>
<div id="dias"></div>

<h3>Horários Disponíveis</h3>
<div id="horarios" class="grid"></div>

<h3>Seus Dados</h3>
<input type="text" id="nome" placeholder="Nome e Sobrenome">
<input type="text" id="telefone" placeholder="Telefone">

<button onclick="agendar()">CONFIRMAR AGENDAMENTO</button>

</div>

<script>
const supabaseClient = supabase.createClient(
"https://vmtizubcbzcscvrjnbkc.supabase.co",
"SUA_ANON_KEY_AQUI"
);

const servicos = [
{nome:"Corte",valor:"R$ 30"},
{nome:"Barba",valor:"R$ 20"},
{nome:"Sobrancelha",valor:"R$ 15"},
{nome:"Pezinho",valor:"R$ 15"},
{nome:"Corte + Sobrancelha",valor:"R$ 35"},
{nome:"Corte + Barba",valor:"R$ 40"},
{nome:"Corte + Barba + Sobrancelha",valor:"R$ 45"},
{nome:"Sidcut",valor:"R$ 20"}
];

let servicoSelecionado=null;
let diaSelecionado=null;
let horarioSelecionado=null;

function renderServicos(){
let div=document.getElementById("servicos");
servicos.forEach(s=>{
let el=document.createElement("div");
el.className="card";
el.innerHTML=`<b>${s.nome}</b><br><span class="small">${s.valor}</span>`;
el.onclick=()=>{
document.querySelectorAll("#servicos .card").forEach(c=>c.classList.remove("selected"));
el.classList.add("selected");
servicoSelecionado=s.nome;
};
div.appendChild(el);
});
}

function gerarDias(){
let div=document.getElementById("dias");
let hoje=new Date();
let count=0;

while(count<6){
let data=new Date();
data.setDate(hoje.getDate()+count);

if(data.getDay()!=0){
let diaSemana=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"][data.getDay()];
let format=`${data.getDate()}/${data.getMonth()+1}`;

let el=document.createElement("div");
el.className="card";
el.innerHTML=`${format}<br><span class="small">${diaSemana}</span>`;
el.onclick=()=>{
document.querySelectorAll("#dias .card").forEach(c=>c.classList.remove("selected"));
el.classList.add("selected");
diaSelecionado=format;
gerarHorarios();
};
div.appendChild(el);
}
count++;
}
}

async function gerarHorarios(){
let div=document.getElementById("horarios");
div.innerHTML="";
horarioSelecionado=null;

let {data}=await supabaseClient.from("agendamentos").select("horario").eq("dia",diaSelecionado);

let ocupados=data?data.map(d=>d.horario):[];

for(let h=8;h<=15;h++){
for(let m of ["00","30"]){
let horario=`${h}:${m}`;
if(h==15 && m=="30"){}
if(!ocupados.includes(horario)){
let el=document.createElement("div");
el.className="card";
el.innerHTML=horario;
el.onclick=()=>{
document.querySelectorAll("#horarios .card").forEach(c=>c.classList.remove("selected"));
el.classList.add("selected");
horarioSelecionado=horario;
};
div.appendChild(el);
}
}
}
}

async function agendar(){
let nome=document.getElementById("nome").value.trim();
let telefone=document.getElementById("telefone").value.trim();

if(!nome || nome.split(" ").length<2){
alert("Digite nome e sobrenome.");
return;
}

if(!servicoSelecionado||!diaSelecionado||!horarioSelecionado){
alert("Preencha todas as opções.");
return;
}

await supabaseClient.from("agendamentos").insert([{
nome,
telefone,
servico:servicoSelecionado,
dia:diaSelecionado,
horario:horarioSelecionado
}]);

alert("Agendamento realizado!");
location.reload();
}

renderServicos();
gerarDias();
</script>

</body>
</html>
