<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Menezes Barbearia</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
    margin:0;
    font-family:'Poppins', sans-serif;
    background:#0d0d0d;
    color:white;
}

.hero{
    height:65vh;
    background:linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.9)),
    url('https://images.unsplash.com/photo-1585747860715-2ba37e788b70?auto=format&fit=crop&w=1500&q=80');
    background-size:cover;
    background-position:center;
    display:flex;
    justify-content:center;
    align-items:center;
    text-align:center;
}

.hero h1{
    font-family:'Playfair Display', serif;
    font-size:42px;
    color:#d4af37;
    letter-spacing:2px;
}

.section{
    padding:70px 20px;
    text-align:center;
}

.section h3{
    font-family:'Playfair Display', serif;
    color:#d4af37;
    font-size:30px;
}

.card-agendamento{
    max-width:450px;
    margin:40px auto;
    background:#141414;
    padding:35px;
    border-radius:18px;
    border:1px solid #d4af37;
    box-shadow:0 0 30px rgba(212,175,55,0.1);
}

form{
    display:flex;
    flex-direction:column;
    gap:18px;
}

input, select{
    padding:14px;
    border-radius:10px;
    border:1px solid #d4af37;
    background:#1c1c1c;
    color:white;
    font-size:14px;
}

input:focus, select:focus{
    outline:none;
    box-shadow:0 0 8px #d4af37;
}

button{
    background:#d4af37;
    border:none;
    padding:15px;
    border-radius:30px;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
}

button:hover{
    background:white;
}

.msg{
    margin-top:10px;
    font-weight:600;
}
</style>
</head>

<body>

<div class="hero">
    <h1>MENEZES BARBEARIA</h1>
</div>

<div class="section">
    <h3>Agende seu horário</h3>

    <div class="card-agendamento">
        <form id="form">
            <input type="text" id="nome" placeholder="Nome e Sobrenome" required>
            <input type="tel" id="telefone" placeholder="Telefone" required>

            <select id="servico" required>
                <option value="">Escolha o serviço</option>
                <option>Corte — R$30</option>
                <option>Barba — R$10</option>
                <option>Sobrancelha — R$5</option>
                <option>Corte + Barba + Sobrancelha — R$45</option>
            </select>

            <select id="data" required>
                <option value="">Selecione o dia</option>
            </select>

            <select id="horario" required>
                <option value="">Selecione o horário</option>
            </select>

            <button type="submit">CONFIRMAR AGENDAMENTO</button>
            <div class="msg" id="msg"></div>
        </form>
    </div>
</div>

<script>
const supabaseClient = supabase.createClient(
  "https://vmtizubcbzcscvrjnbkc.supabase.co",
  "sb_publishable_yTBSdMmjv1qIH8V9FViobw_DBIwtm_D"
);

const diasSemana = ["Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado"];

const dataSelect = document.getElementById("data");
const horarioSelect = document.getElementById("horario");
const form = document.getElementById("form");
const msg = document.getElementById("msg");

function gerarDias() {
    const hoje = new Date();
    dataSelect.innerHTML = '<option value="">Selecione o dia</option>';
    let adicionados = 0;
    let i = 0;

    while (adicionados < 6) {
        let data = new Date();
        data.setDate(hoje.getDate() + i);

        if (data.getDay() !== 0) {
            const iso = data.toISOString().split("T")[0];
            const option = document.createElement("option");
            option.value = iso;
            option.textContent = `${diasSemana[data.getDay()]} — ${data.toLocaleDateString("pt-BR")}`;
            dataSelect.appendChild(option);
            adicionados++;
        }
        i++;
    }
}

function gerarHorarios() {
    let horarios = [];
    for (let h = 8; h <= 15; h++) {
        horarios.push(`${String(h).padStart(2,'0')}:00`);
        if (h !== 15) horarios.push(`${String(h).padStart(2,'0')}:30`);
    }
    return horarios;
}

dataSelect.addEventListener("change", async () => {
    horarioSelect.innerHTML = '<option value="">Carregando...</option>';

    const { data: agendados } = await supabaseClient
        .from("agendamentos")
        .select("horario")
        .eq("data", dataSelect.value);

    const ocupados = agendados ? agendados.map(a => a.horario.slice(0,5)) : [];
    const todos = gerarHor
